<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<title>IMDB API</title>
		<meta name="description" content="">
		<meta name="viewport" content="width=device-width">
		<link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}">
		<link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.no-icons.min.css" rel="stylesheet">
		<style type="text/css" media="screen">
			.hidden {
				display: none;
				visibility: hidden;
			}

			ul.details {
				margin-left: 120px;
				list-style-type: none;
			}

			ul ul {
				list-style-type: none;
			}

			ng-cloak: {
				display: none !important;
			}
		</style>
	</head>
	<body ng-app>
		{% raw %}
		<div class="container" ng-controller="AppCtrl">
			<h1>Simple IMDb API</h1>
			<p><a href="/tt1446714" target="_blank">http://imdb-api.herokuapp.com/tt1446714</a></p>

			<form class="input-append" ng-submit="search()">
				<input class="span2" type="text" ng-model="imdbId" placeholder="tt1446714">
				<button class="btn" type="submit">Search</button>
			</form>

			<img src="static/img/loading.gif" ng-show="loading">
			<div ng-show="movie" ng-cloak>
				<h3>{{ movie.title }}</h3>
				<img ng-src="{{ movie.poster }}" class="img-rounded pull-left" width="100">
				<ul class="details">
					<li><strong>Genres:</strong>
						<ul>
							<li ng-repeat="genre in movie.genres">{{ genre }}</li>
						</ul>
					</li>
					<li><strong>Rating</strong>: {{ movie.vote_average }} ({{ movie.vote_count }} votes)</li>
					<li><strong>Release date</strong>: {{ movie.release_date }}</li>
					<li><strong>Plot summary</strong>:</li>
					<li>{{ movie.plot_summary }}</li>
				</ul>
			</div>
			
		</div>
		{% endraw %}

		<script src="//ajax.googleapis.com/ajax/libs/angularjs/1.0.7/angular.min.js"></script>
		<script>
			function AppCtrl($scope, $http) {
				$scope.search = function() {
					$scope.loading = true;

					var imdbId = $scope.imdbId.match(/tt[\d]{7}/);

					if (imdbId) {
						var movie = $http.get('/' + imdbId[0]);
						
						movie.success(function(response) {
							$scope.loading = false;
							$scope.movie = response;
						});

						movie.error(function(response) {
							$scope.loading = false;
							console.log(response);
						});
					}
				};
			}
		</script>

		<script>
			(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
			function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
			e=o.createElement(i);r=o.getElementsByTagName(i)[0];
			e.src='//www.google-analytics.com/analytics.js';
			r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
			ga('create','UA-34240614-1');ga('send','pageview');
		</script>
	</body>
</html>
